<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Marker Clustering</title>
    <link rel="stylesheet" type="text/css" href="LOCATR/blob/master/wwwroot/css/tiborIxD.css">
    <script type="text/javascript" charset="UTF-8" src="LOCATR/blob/master/wwwroot/js/tiborIxD.js"></script>
    <style> 
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #gmap {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      .container{
        height: 100%;
        margin: 0 auto;
        max-height: 600px;
        max-width: 1200px;
        overflow: hidden;
        position: relative;
        width: 100%;
      }
      
    </style>
  </head>
  <body>
    <div class="container card shadow-z1">
      <div id="leftPanel" class="panel left">
        <div id="switch" class="icon">
          <svg id="filter" fill="#000000" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"></path>
              <path d="M0 0h24v24H0z" fill="none"></path>
          </svg>
          <svg id="close" class="hide" fill="#000000" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path>
              <path d="M0 0h24v24H0z" fill="none"></path>
          </svg>
        </div>
        <h5>Filter</h5>

        <div id="filterChoices" class="choices">
            <label class="input-checkbox" for="check1">
                <input type="checkbox" id="check1" value="TypeA" onchange="filter(this);"/>
                <div class="checkbox"></div>
                Type A
            </label>
            <label class="input-checkbox" for="check2">
                <input type="checkbox" id="check2" value="TypeB" onchange="filter(this);"/>
                <div class="checkbox"></div>
                Type B
            </label>
            <label class="input-checkbox" for="check3">
                <input type="checkbox" id="check3" value="TypeC" onchange="filter(this);"/>
                <div class="checkbox"></div>
                Type C
            </label>
             <a href="#" class="secondary-action reset" onclick="filter(this);">Reset filters</a>
        </div>
        
      </div>
      <div id="gmap" style="background-color:#ececec;"></div>
      <div id="rightPanel" class="panel location-info right">
        <div id="switch" class="icon">
          <svg id="close" fill="#000000" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path>
              <path d="M0 0h24v24H0z" fill="none"></path>
          </svg>
        </div>
      </div>
    </div>
    <script>

      function initMap() {

        var pingPong;

        var map = new google.maps.Map(document.getElementById('gmap'), {
          zoom: 3,
          center: {lat: -28.024, lng: 140.887},
          scrollwheel: false,
          disableDefaultUI: true,
          fullscreenControl: true,
          fullscreenControlOptions: {
              position: google.maps.ControlPosition.BOTTOM_CENTER
          },
          zoomControl: true,
          zoomControlOptions: {
              position: google.maps.ControlPosition.BOTTOM_CENTER
          },
          styles:
          [
            {
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#f5f5f5"
                }
              ]
            },
            {
              "elementType": "labels.icon",
              "stylers": [
                {
                  "visibility": "off"
                }
              ]
            },
            {
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#616161"
                }
              ]
            },
            {
              "elementType": "labels.text.stroke",
              "stylers": [
                {
                  "color": "#f5f5f5"
                }
              ]
            },
            {
              "featureType": "administrative",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#FF0000"
                },
                {
                  "visibility": "off"
                }
              ]
            },
            {
              "featureType": "administrative.country",
              "elementType": "geometry.stroke",
              "stylers": [
                {
                  "color": "#FF0000"
                },
                {
                  "visibility": "on"
                },
                {
                  "weight": 3
                }
              ]
            },
            {
              "featureType": "administrative.land_parcel",
              "elementType": "labels",
              "stylers": [
                {
                  "color": "#FF0000"
                },
                {
                  "visibility": "simplified"
                },
                {
                  "weight": 6
                }
              ]
            },
            {
              "featureType": "administrative.land_parcel",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#bdbdbd"
                }
              ]
            },
            {
              "featureType": "poi",
              "stylers": [
                {
                  "visibility": "off"
                }
              ]
            },
            {
              "featureType": "poi",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#eeeeee"
                }
              ]
            },
            {
              "featureType": "poi",
              "elementType": "labels.text",
              "stylers": [
                {
                  "visibility": "off"
                }
              ]
            },
            {
              "featureType": "poi",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#757575"
                }
              ]
            },
            {
              "featureType": "poi.park",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#e5e5e5"
                }
              ]
            },
            {
              "featureType": "poi.park",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#9e9e9e"
                }
              ]
            },
            {
              "featureType": "road",
              "stylers": [
                {
                  "visibility": "off"
                }
              ]
            },
            {
              "featureType": "road",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#ffffff"
                }
              ]
            },
            {
              "featureType": "road",
              "elementType": "labels.icon",
              "stylers": [
                {
                  "visibility": "off"
                }
              ]
            },
            {
              "featureType": "road.arterial",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#757575"
                }
              ]
            },
            {
              "featureType": "road.highway",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#dadada"
                }
              ]
            },
            {
              "featureType": "road.highway",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#616161"
                }
              ]
            },
            {
              "featureType": "road.local",
              "elementType": "labels",
              "stylers": [
                {
                  "visibility": "off"
                }
              ]
            },
            {
              "featureType": "road.local",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#9e9e9e"
                }
              ]
            },
            {
              "featureType": "transit",
              "stylers": [
                {
                  "visibility": "off"
                }
              ]
            },
            {
              "featureType": "transit.line",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#e5e5e5"
                }
              ]
            },
            {
              "featureType": "transit.station",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#eeeeee"
                }
              ]
            },
            {
              "featureType": "water",
              "elementType": "geometry",
              "stylers": [
                {
                  "color": "#c9c9c9"
                }
              ]
            },
            {
              "featureType": "water",
              "elementType": "labels.text.fill",
              "stylers": [
                {
                  "color": "#9e9e9e"
                }
              ]
            }
          ]
        });

        var allMarkers = [];

        var markerCluster = markerCluster;

        // var iconImage = 'wwwroot/images/custom_marker.png';
        var markers = locations.map(function(location, i, markers) {
          var marker = new google.maps.Marker({
            position: location,
            // icon: iconImage,
            label: location.label,
            title: location.label,
            phone: location.phone,
            mail: location.mail,
            imageSrc: location.imageSrc,
            type: location.type
          });
          allMarkers.push(marker);

          marker.addListener('click', function() {
            var b = new Panel('rightPanel', false, marker).open();
            map.panTo(marker.getPosition());
          });

          filter = function (element) {
            var updatedMarkers = [];
            var updateDatedChoice = [];
            var allChoice = [];

            var choicesContainer = document.getElementById('filterChoices');
            var choices = document.querySelectorAll('#' + choicesContainer.id + ' ' + 'input');

            choices.forEach(function(choice, x){
              allChoice.push(choice);

              var updateDatedChoice = allChoice.filter(function(item){
                return item.checked == choices[x].checked;
              });

              if(updateDatedChoice.length == choices.length){

                console.log('no filter active');
                
                var updatedMarkers =  allMarkers.filter(function(item){
                  return item.type = item.type;
                });

                resetMarkerCluster(updatedMarkers);
                updatedMarkers = [];
                
              } else {


                if(choices[x].checked){
                  console.log('filter(s) active');
                  var updatedMarkers =  allMarkers.filter(function(item){
                    return item.type == choices[x].value;
                  });

                  updateMarkerCluster(updatedMarkers, true);
                  updatedMarkers = [];
                } else {

                  var updatedMarkers =  allMarkers.filter(function(item){
                    return item.type == choices[x].value;
                  });

                  updateMarkerCluster(updatedMarkers, false);
                  updatedMarkers = [];
                }
              }
            });
          }
          return marker;
        });
        
        var updateMarkerCluster = function (updatedMarkers, bool) {
          updatedMarkers.forEach(function(markers, i){
            if(!bool){
              markers.setMap(null);
              markerCluster.removeMarker(markers);
            } else {
              markers.setMap(map);
              markerCluster.addMarker(markers);
            }
          });
        }
        var resetMarkerCluster = function (updatedMarkers) {
          updatedMarkers.forEach(function(markers, i){
            markers.setMap(null);
            markerCluster.removeMarker(markers);
            markers.setMap(map);
            markerCluster.addMarker(markers);
          });
        }

        // Add a marker clusterer to manage the markers.
        var markerCluster = new MarkerClusterer(map, markers,
            {imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'});
            
      }

      var locations = [
        {lat: -31.563910, lng: 147.154312, label: 'a', type: 'TypeA', phone: '020 474 44 23', mail: 'a.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -33.718234, lng: 150.363181, label: 'b', type: 'TypeA', phone: '020 374 44 23', mail: 'b.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -33.727111, lng: 150.371124, label: 'c', type: 'TypeA', phone: '020 574 44 23', mail: 'c.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -33.848588, lng: 151.209834, label: 'd', type: 'TypeA', phone: '020 574 44 23', mail: 'd.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -33.851702, lng: 151.216968, label: 'e', type: 'TypeA', phone: '020 674 44 23', mail: 'e.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -34.671264, lng: 150.863657, label: 'f', type: 'TypeB', phone: '020 474 44 23', mail: 'f.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -35.304724, lng: 148.662905, label: 'g', type: 'TypeB', phone: '020 874 44 23', mail: 'g.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -36.817685, lng: 175.699196, label: 'h', type: 'TypeB', phone: '020 474 44 23', mail: 'h.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -36.828611, lng: 175.790222, label: 'i', type: 'TypeB', phone: '020 974 44 23', mail: 'i.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -37.750000, lng: 145.116667, label: 'j', type: 'TypeB', phone: '020 474 44 23', mail: 'j.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -37.759859, lng: 145.128708, label: 'k', type: 'TypeB', phone: '020 474 44 23', mail: 'k.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -37.765015, lng: 145.133858, label: 'l', type: 'TypeB', phone: '020 274 44 23', mail: 'l.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -37.770104, lng: 145.143299, label: 'm', type: 'TypeB', phone: '020 474 44 23', mail: 'm.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -37.773700, lng: 145.145187, label: 'n', type: 'TypeB', phone: '020 674 44 23', mail: 'n.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -37.774785, lng: 145.137978, label: 'o', type: 'TypeC', phone: '020 464 44 23', mail: 'o.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -37.819616, lng: 144.968119, label: 'p', type: 'TypeC', phone: '020 974 44 23', mail: 'p.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -38.330766, lng: 144.695692, label: 'q', type: 'TypeC', phone: '020 474 44 23', mail: 'q.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -39.927193, lng: 175.053218, label: 'r', type: 'TypeC', phone: '020 374 44 23', mail: 'r.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -41.330162, lng: 174.865694, label: 's', type: 'TypeC', phone: '020 474 44 23', mail: 's.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -42.734358, lng: 147.439506, label: 't', type: 'TypeC', phone: '020 374 44 23', mail: 't.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -42.734358, lng: 147.501315, label: 'u', type: 'TypeC', phone: '020 474 44 23', mail: 'u.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -42.735258, lng: 147.438000, label: 'v', type: 'TypeC', phone: '020 274 44 23', mail: 'v.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'},
        {lat: -43.999792, lng: 170.463352, label: 'w', type: 'TypeC', phone: '020 174 44 23', mail: 'w.mail@mail.nl', imageSrc: 'http://cdn.wallpapersafari.com/25/0/PRM4FK.jpg'}
      ]

    </script>
    <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBG8tjL4OpYUo3hBLFOwXGvFz7n1Fd25uM&callback=initMap">
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        //SCRIPTS go here
        var a = new Panel('leftPanel', true);
        var c = new Checkbox('filterChoices');
      });
    </script>
  </body>
</html>